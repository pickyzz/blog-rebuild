---
import { slugifyStr } from "@/utils/slugify";
import Datetime from "./Datetime.astro";
import type { CollectionEntry } from "astro:content";

export interface Props {
  href?: string;
  frontmatter: any;
  secHeading?: boolean;
  priority?: "high" | "low";
}

const { href, frontmatter, secHeading = true, priority = "low" } = Astro.props;

const { title, pubDatetime, modDatetime, description, ogImage } = frontmatter;
import { isAllowedUrl } from "@/config";

let proxyUrl = ogImage?.src || "/pickyzz-og.png";
let placeholderSrc: string | undefined = undefined;
try {
  if ((ogImage as any)?.placeholder) {
    placeholderSrc = (ogImage as any).placeholder as string;
  }
  if (isAllowedUrl(proxyUrl)) {
    // base64url encode the encodedURIComponent to make a path-safe token
    const encoded = Buffer.from(encodeURIComponent(proxyUrl), 'utf8')
      .toString('base64')
      .replace(/\+/g, '-')
      .replace(/\//g, '_')
      .replace(/=+$/, '');
    proxyUrl = `/api/image/p/${encoded}`;
  }
} catch (e) {}

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
  class:
    "text-white text-[1.1rem] text-center text-lg font-light decoration-dashed",
};
---

<li class="my-6 max-h-[350px]">
  <a
    id="card-url"
    href={href}
    class="decoration-dashed underline-offset-4 focus-visible:no-underline focus-visible:underline-offset-0"
  >
    <div
      class="relative mb-4 flex-shrink-0 overflow-hidden rounded-lg object-cover"
    >
        <img
  class="card-animate h-[13rem] w-[100vw] scale-125 object-cover object-center duration-500 hover:scale-110 md:scale-100 img-loading blurry-load"
        src={placeholderSrc || proxyUrl}
        data-large={proxyUrl}
        loading="lazy"
        decoding="async"
        fetchpriority={priority}
        alt={title
          ? `Cover image for blog post: ${title}`
          : "Blog post cover image"}
      />
      <div
        class="absolute bottom-0 left-0 right-0 flex min-h-[35%] items-center justify-center bg-black/75 px-10 py-2"
      >
        {
          secHeading ? (
            <h2 {...headerProps}>{title}</h2>
          ) : (
            <h3 {...headerProps}>{title}</h3>
          )
        }
      </div>
    </div>
    <p class="mb-4 line-clamp-2 h-[3rem] text-center text-base">
      {description}
    </p>
  </a>
  <Datetime
    pubDatetime={pubDatetime}
    modDatetime={modDatetime}
    class="justify-center"
  />
</li>
