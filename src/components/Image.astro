---
import { generateResponsiveImageAttrs } from "../helpers/images.mjs";

const {
  src, // base filename without extension, e.g. "cover"
  formats = ["avif", "webp", "jpeg"],
  widths = [400, 800, 1200, 1400],
  sizes = "100vw",
  imageClass = "w-fit h-auto bg-gray-100 rounded-xl",
  alt = "Blog Image",
  loading = "lazy",
  decoding = "async",
  fetchpriority = "auto",
} = Astro.props;

const attrs = generateResponsiveImageAttrs({
  src,
  formats,
  widths,
  sizes,
  alt,
  loading,
  decoding,
  fetchpriority,
  className: imageClass
});
---

<picture>
  {formats.map(format => (
    <source
      srcset={widths.map(w => `/assets/images/blog/${src}-${w}.${format} ${w}w`).join(", ")}
      type={`image/${format}`}
      sizes={sizes}
    />
  ))}
  <img
    src={`/assets/images/blog/${src}-${widths[widths.length - 1]}.${formats[formats.length - 1]}`}
    alt={alt}
    class={imageClass}
    loading={loading}
    decoding={decoding}
    fetchpriority={fetchpriority}
    width={widths[widths.length - 1]}
    style="max-width:100%;height:auto;"
  />
</picture>