---
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Layout from "@/layouts/Layout.astro";
import Main from "@/layouts/Main.astro";
import Tag from "@/components/Tag.astro";
import { SITE } from "@/config";
import { getCollection } from "astro:content";

// Get all posts and extract unique tags
const posts = await getCollection("blog", ({ data }) => !data.draft);
const tagMap = new Map<string, string>();

posts.forEach(post => {
  post.data.tags.forEach(tag => {
    if (!tagMap.has(tag)) {
      tagMap.set(tag, tag);
    }
  });
});

const tags = Array.from(tagMap.entries()).map(([tag, tagName]) => ({
  tag,
  tagName
}));
---

<Layout title={`Tags | ${SITE.title}`}>
  <Header />
  <Main pageTitle="Tags" pageDesc="All the tags used in posts.">
    <ul class="mx-auto max-w-[90vw] md:max-w-4xl">
      {tags.map(({ tag, tagName }) => <Tag {tag} {tagName} size="lg" />)}
    </ul>
  </Main>
  <Footer />
</Layout>
