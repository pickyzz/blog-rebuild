---
import PostDetails from "@/layouts/PostDetails.astro";
import { getCollection } from "astro:content";

export interface Props {
  post: any;
}

/* SSG mode: generate static paths */
export const prerender = true;
export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.slug }, // Astro automatically generates slug from filename
    props: { post },
  }));
}

const post = Astro.props.post;

if (!post || !post.data) {
  return Astro.redirect("/404");
}

const posts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => new Date(b.data.pubDatetime).valueOf() - new Date(a.data.pubDatetime).valueOf()
);
---

<PostDetails post={post} posts={sortedPosts} />
