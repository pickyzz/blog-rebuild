# Environment Variables Template
# Copy this to .env and fill in your actual values
# Remove comments before using in production

# ===================================================================
# CORE SETTINGS (REQUIRED)
# ===================================================================

# Environment: development | production
NODE_ENV=development

# Notion Integration - REQUIRED for blog functionality
# Create at https://www.notion.so/my-integrations
NOTION_KEY=YOUR_NOTION_INTEGRATION_TOKEN
# Get from Notion database URL (after ? and before #)
DATABASE_ID=YOUR_NOTION_DATABASE_ID

# Upstash Redis - REQUIRED for persistent caching
# Create at https://console.upstash.com/
UPSTASH_REDIS_REST_URL=YOUR_UPSTASH_REDIS_REST_URL
UPSTASH_REDIS_REST_TOKEN=YOUR_UPSTASH_REDIS_REST_TOKEN

# ===================================================================
# API SECURITY
# ===================================================================

# Secret key for protected API endpoints
API_SECRET_KEY=GENERATE_A_RANDOM_32_CHAR_SECRET

# Webhook and scheduled refresh authentication (optional)
WEBHOOK_SECRET=GENERATE_A_RANDOM_WEBHOOK_SECRET
SCHEDULED_REFRESH_KEY=GENERATE_A_RANDOM_SCHEDULED_KEY

# Rate limiting configuration (optional - overrides defaults)
# RATE_LIMIT_OVERRIDE={"SENSITIVE":{"max":10,"window":"5 m"},"MODERATE":{"max":50,"window":"1 m"}}
# RATE_LIMIT_DEBUG=false

# ===================================================================
# CACHING SETTINGS
# ===================================================================

# Cache TTLs (milliseconds) - FREE PLAN optimized values
# Reduced to save Upstash Redis requests (10k/day limit)
POSTS_CACHE_TTL=900000                    # 15 minutes (was 30)
TAGS_CACHE_TTL=1800000                    # 30 minutes (was 60)
POST_BY_SLUG_NEW_CACHE_TTL=600000         # 10 minutes (was 20)
POST_BY_SLUG_OLD_CACHE_TTL=480000         # 8 minutes (was 15)
POSTS_BY_TAG=900000                       # 15 minutes (was 30)

# ===================================================================
# IMAGE PROXY & PROCESSING (FREE PLAN optimized)
# ===================================================================

# Image proxy limits and performance - optimized for 10s timeout
IMAGE_MAX_BYTES=3145728                  # 3MB max file size (was 5MB)
IMAGE_EDGE_S_MAXAGE=7200                 # 2 hours cache (was 24 hours)
IMAGE_ERROR_S_MAXAGE=30                  # 30 seconds cache (was 60)
IMAGE_PROXY_MAX_CONCURRENT=4             # Reduced for 10s timeout (was 10)
IMAGE_PROXY_HOST_COOLDOWN_MS=500         # Longer cooldown (was 200ms)
IMAGE_PROXY_FETCH_TIMEOUT_MS=8000        # 8 seconds timeout (under 10s limit)

# Image placeholder generation
IMAGE_PLACEHOLDER_WIDTH=32               # Placeholder width in pixels
IMAGE_PLACEHOLDER_QUALITY=30             # JPEG quality (0-100)

# Site origin for image proxy URLs
SITE_ORIGIN=https://yourdomain.com

# ===================================================================
# CLOUDFLARE INTEGRATION (optional)
# ===================================================================

# Cloudflare API for cache purging (if using CF)
CF_ZONE_ID=YOUR_CLOUDFLARE_ZONE_ID
CF_API_TOKEN=YOUR_CLOUDFLARE_API_TOKEN

# Purge configuration
CF_PURGE_URLS=yourdomain.com/og.png,yourdomain.com/feed.xml
CF_PURGE_BATCH_SIZE=30
CF_PURGE_BATCH_DELAY_MS=500
CF_PURGE_BATCH_RETRIES=2
CF_PURGE_BATCH_MS=2000
CF_PURGE_MAX_BATCH=30
CF_PURGE_MAX_RETRIES=3

# ===================================================================
# DEVELOPMENT & CI/CD
# ===================================================================

# Notion API rate limiting (requests per second)
NOTION_RATE_LIMIT=3

# CI environment (used by Playwright)
CI=false

# ===================================================================
# DEBUGGING & MONITORING (Free Plan aware)
# ===================================================================

# Enable detailed image proxy logging (use sparingly on Free Plan!)
# Set to "true" to see image request logs in console
# WARNING: Increases function execution time and memory usage
DEBUG_IMAGE_PROXY=false

# Free Plan monitoring (optional)
# Enable to track Upstash Redis usage
REDIS_USAGE_MONITORING=false

# ===================================================================
# ADDITIONAL CONFIGURATION (advanced)
# ===================================================================

# Image proxy additional settings
IMAGE_PROXY_FETCH_TIMEOUT_MS=12000       # 12 seconds timeout for upstream requests
IMAGE_PROXY_HOST_COOLDOWN_MS=200         # Delay between requests to same host

# Cloudflare purge additional settings
CF_PURGE_BATCH_MS=2000                   # Debounce window for purge queue
CF_PURGE_MAX_BATCH=30                    # Maximum items per purge batch

# Development/Build settings
# Used by scripts and build processes
IMAGE_PLACEHOLDER_WIDTH=32               # Placeholder generation width
IMAGE_PLACEHOLDER_QUALITY=30             # JPEG quality for placeholders
